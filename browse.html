<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Browse Providers – VelvetZone</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <a href="index.html" class="logo">
        <span class="velvet">Velvet</span>Zone
        <span class="blockchain-badge">BLOCKCHAIN SECURED</span>
      </a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="dashboard.html">Dashboard</a>
        <div class="auth-buttons">
          <a href="login.html" class="btn btn-outline">Login</a>
          <a href="signup.html" class="btn">Sign Up</a>
        </div>
      </div>
      <button class="hamburger">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </nav>

  <main class="browse-container">
    <div class="container">
      <div class="browse-header">
        <h1>Browse Providers</h1>
        <p>Find your perfect match in your area</p>
      </div>

      <section class="filters-section">
        <form id="filterForm" class="filter-form">
          <div class="filter-group">
            <label for="country">Country</label>
            <select id="country">
              <option value="">All Countries</option>
              <option value="Ghana">Ghana</option>
              <option value="Nigeria">Nigeria</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="city">City</label>
            <input type="text" id="city" placeholder="Enter city">
          </div>
          
          <div class="filter-group">
            <label for="gender">Gender</label>
            <select id="gender">
              <option value="">All Genders</option>
              <option value="Female">Female</option>
              <option value="Male">Male</option>
              <option value="Trans">Trans</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="sort">Sort By</label>
            <select id="sort">
              <option value="desc">Latest First</option>
              <option value="asc">Oldest First</option>
              <option value="az">Name A-Z</option>
              <option value="za">Name Z-A</option>
            </select>
          </div>
          
          <button type="submit" class="btn btn-gradient">
            <i class="fas fa-filter"></i> Apply Filters
          </button>
        </form>
      </section>

      <section class="results-section">
        <div id="providersList" class="providers-grid"></div>
      </section>
    </div>
  </main>

  <footer class="blockchain-footer">
    <!-- Same footer as index.html -->
  </footer>

  <script type="module">
    import { db } from './js/firebase-config.js';
    import { collection, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const filterForm = document.getElementById('filterForm');
    const providersList = document.getElementById('providersList');

    let unsubscribe = null;

    function renderProvider(provider, id) {
      return `
        <div class="provider-card">
          <div class="provider-card-inner">
            <div class="provider-image">
              <img src="${provider.profileImage || 'default.jpg'}" alt="${provider.name}">
              ${provider.verified ? '<span class="verified-badge"><i class="fas fa-check-circle"></i> Verified</span>' : ''}
            </div>
            <div class="provider-info">
              <h3>
                <a href="profile-view.html?id=${id}">${provider.name}</a>
              </h3>
              <p class="location"><i class="fas fa-map-marker-alt"></i> ${provider.city}, ${provider.country || 'N/A'}</p>
              <p class="gender"><i class="fas fa-user"></i> ${provider.gender} • ${provider.orientation || ''}</p>
              <p class="bio">${provider.bio?.substring(0, 100)}${provider.bio?.length > 100 ? '...' : ''}</p>
              <div class="provider-actions">
                <a href="profile-view.html?id=${id}" class="btn btn-outline">View Profile</a>
                <a href="chat.html?providerId=${id}" class="btn btn-gradient">Chat Now</a>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function applyFilters() {
      const country = document.getElementById('country').value.trim();
      const city = document.getElementById('city').value.trim().toLowerCase();
      const gender = document.getElementById('gender').value;
      const sort = document.getElementById('sort').value;

      const providersRef = collection(db, "providers");
      const filters = [];
      if (country) filters.push(where("country", "==", country));
      if (gender) filters.push(where("gender", "==", gender));

      let sorting;
      if (sort === "asc" || sort === "desc") {
        sorting = orderBy("createdAt", sort);
      } else {
        sorting = orderBy("name");
      }

      if (unsubscribe) unsubscribe();

      let q;
      if (filters.length) {
        q = query(providersRef, ...filters, sorting);
      } else {
        q = query(providersRef, sorting);
      }

      unsubscribe = onSnapshot(q, (snapshot) => {
        providersList.innerHTML = "";
        let providers = [];
        snapshot.forEach((doc) => {
          const data = doc.data();
          if (city && data.city?.toLowerCase() !== city) return;
          providers.push({ id: doc.id, ...data });
        });

        if (sort === "az") {
          providers.sort((a, b) => a.name.localeCompare(b.name));
        } else if (sort === "za") {
          providers.sort((a, b) => b.name.localeCompare(a.name));
        }

        providers.forEach((provider) => {
          providersList.innerHTML += renderProvider(provider, provider.id);
        });

        if (providers.length === 0) {
          providersList.innerHTML = `
            <div class="no-results">
              <i class="fas fa-user-slash"></i>
              <h3>No providers found</h3>
              <p>Try adjusting your filters or check back later</p>
            </div>
          `;
        }
      });
    }

    filterForm.addEventListener("submit", (e) => {
      e.preventDefault();
      applyFilters();
    });

    applyFilters();
  </script>

  <style>
    .browse-container {
      padding: 100px 0 60px;
      min-height: 100vh;
    }

    .browse-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .browse-header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .browse-header p {
      color: rgba(255, 255, 255, 0.7);
    }

    .filter-form {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      background: rgba(30, 30, 30, 0.6);
      backdrop-filter: blur(10px);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 40px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-group label {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
    }

    .filter-group select,
    .filter-group input {
      padding: 10px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      color: white;
      font-size: 0.95rem;
    }

    .filter-form button {
      grid-column: 1 / -1;
      align-self: end;
    }

    .providers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
    }

    .provider-card {
      background: rgba(30, 30, 30, 0.6);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .provider-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      border-color: var(--primary);
    }

    .provider-image {
      position: relative;
      height: 200px;
      overflow: hidden;
    }

    .provider-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s;
    }

    .provider-card:hover .provider-image img {
      transform: scale(1.05);
    }

    .verified-badge {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: var(--primary);
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .provider-info {
      padding: 20px;
    }

    .provider-info h3 a {
      color: white;
      text-decoration: none;
      transition: color 0.3s;
    }

    .provider-info h3 a:hover {
      color: var(--primary);
    }

    .provider-info p {
      margin: 8px 0;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
    }

    .provider-info p i {
      margin-right: 5px;
      color: var(--primary);
    }

    .provider-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .provider-actions .btn {
      flex: 1;
      padding: 8px;
      font-size: 0.9rem;
    }

    .no-results {
      grid-column: 1 / -1;
      text-align: center;
      padding: 40px;
      color: rgba(255, 255, 255, 0.7);
    }

    .no-results i {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .filter-form {
        grid-template-columns: 1fr;
      }

      .providers-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</body>
</html>