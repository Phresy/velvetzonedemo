<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel – VelvetZone</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="admin-container">
    <!-- Admin Sidebar -->
    <aside class="admin-sidebar">
      <div class="sidebar-header">
        <h2><span class="velvet">Velvet</span>Zone Admin</h2>
        <div class="admin-info">
          <img src="admin-avatar.jpg" alt="Admin Avatar">
          <p>Admin User</p>
          <small>Super Admin</small>
        </div>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li class="active"><a href="#dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
          <li><a href="#users"><i class="fas fa-users"></i> Users</a></li>
          <li><a href="#providers"><i class="fas fa-user-tie"></i> Providers</a></li>
          <li><a href="#verifications"><i class="fas fa-check-circle"></i> Verifications</a></li>
          <li><a href="#reports"><i class="fas fa-flag"></i> Reports</a></li>
          <li><a href="#transactions"><i class="fas fa-money-bill-wave"></i> Transactions</a></li>
          <li><a href="#settings"><i class="fas fa-cog"></i> Settings</a></li>
        </ul>
      </nav>
      <div class="sidebar-footer">
        <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
      </div>
    </aside>

    <!-- Admin Main Content -->
    <main class="admin-main">
      <header class="admin-header">
        <div class="header-left">
          <button id="sidebarToggle"><i class="fas fa-bars"></i></button>
          <h1 id="adminPageTitle">Dashboard</h1>
        </div>
        <div class="header-right">
          <div class="notifications">
            <i class="fas fa-bell"></i>
            <span class="badge">3</span>
          </div>
          <div class="admin-search">
            <input type="text" placeholder="Search...">
            <button><i class="fas fa-search"></i></button>
          </div>
        </div>
      </header>

      <div class="admin-content">
        <!-- Dashboard Content -->
        <section id="dashboardContent" class="admin-section">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon primary">
                <i class="fas fa-users"></i>
              </div>
              <div class="stat-info">
                <h3>Total Users</h3>
                <p id="totalUsers">1,245</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon success">
                <i class="fas fa-user-tie"></i>
              </div>
              <div class="stat-info">
                <h3>Providers</h3>
                <p id="totalProviders">328</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon warning">
                <i class="fas fa-money-bill-wave"></i>
              </div>
              <div class="stat-info">
                <h3>Revenue</h3>
                <p id="totalRevenue">₵12,450</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-card danger">
                <i class="fas fa-flag"></i>
              </div>
              <div class="stat-info">
                <h3>Reports</h3>
                <p id="totalReports">24</p>
              </div>
            </div>
          </div>

          <div class="admin-row">
            <div class="admin-col">
              <div class="admin-card">
                <div class="card-header">
                  <h3>Recent Signups</h3>
                  <a href="#" class="btn-link">View All</a>
                </div>
                <div class="table-responsive">
                  <table id="recentUsersTable">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Date</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Will be populated by JavaScript -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="admin-col">
              <div class="admin-card">
                <div class="card-header">
                  <h3>Pending Verifications</h3>
                  <a href="#" class="btn-link">View All</a>
                </div>
                <div class="table-responsive">
                  <table id="pendingVerificationsTable">
                    <thead>
                      <tr>
                        <th>Provider</th>
                        <th>Submitted</th>
                        <th>Status</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Will be populated by JavaScript -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Other sections would be here (hidden by default) -->
      </div>
    </main>
  </div>

  <script type="module">
    import { auth, db } from './js/firebase-config.js';
    import { signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { collection, query, where, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Check admin status
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = 'admin-login.html';
        return;
      }

      // Verify admin role
      const userDoc = await getDoc(doc(db, "users", user.uid));
      if (!userDoc.exists() || userDoc.data().role !== "admin") {
        window.location.href = 'dashboard.html';
      }
    });

    // Load admin data
    async function loadAdminData() {
      // Load user stats
      const usersQuery = query(collection(db, "users"));
      const providersQuery = query(collection(db, "providers"));
      const verificationsQuery = query(collection(db, "verifications"), where("status", "==", "pending"));

      const [usersSnapshot, providersSnapshot, verificationsSnapshot] = await Promise.all([
        getDocs(usersQuery),
        getDocs(providersQuery),
        getDocs(verificationsQuery)
      ]);

      document.getElementById("totalUsers").textContent = usersSnapshot.size;
      document.getElementById("totalProviders").textContent = providersSnapshot.size;
      document.getElementById("totalReports").textContent = verificationsSnapshot.size;

      // Populate recent users
      const usersTable = document.getElementById("recentUsersTable").querySelector("tbody");
      usersTable.innerHTML = "";
      
      usersSnapshot.docs.slice(0, 5).forEach(doc => {
        const user = doc.data();
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${user.displayName || 'N/A'}</td>
          <td>${user.email || 'N/A'}</td>
          <td><span class="badge ${user.role === 'provider' ? 'primary' : ''}">${user.role}</span></td>
          <td>${new Date(user.createdAt?.seconds * 1000).toLocaleDateString()}</td>
          <td>
            <button class="btn-icon view-user" data-id="${doc.id}"><i class="fas fa-eye"></i></button>
            ${user.role === 'provider' ? `<button class="btn-icon verify-user" data-id="${doc.id}"><i class="fas fa-check"></i></button>` : ''}
          </td>
        `;
        usersTable.appendChild(row);
      });

      // Populate pending verifications
      const verificationsTable = document.getElementById("pendingVerificationsTable").querySelector("tbody");
      verificationsTable.innerHTML = "";
      
      verificationsSnapshot.docs.slice(0, 5).forEach(doc => {
        const verification = doc.data();
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${verification.providerName || 'N/A'}</td>
          <td>${new Date(verification.submittedAt?.seconds * 1000).toLocaleDateString()}</td>
          <td><span class="badge warning">Pending</span></td>
          <td>
            <button class="btn-icon approve-verification" data-id="${doc.id}"><i class="fas fa-check"></i></button>
            <button class="btn-icon reject-verification" data-id="${doc.id}"><i class="fas fa-times"></i></button>
            <button class="btn-icon view-details" data-id="${doc.id}"><i class="fas fa-info-circle"></i></button>
          </td>
        `;
        verificationsTable.appendChild(row);
      });
    }

    // Logout functionality
    document.getElementById("logoutBtn").addEventListener("click", async () => {
      try {
        await signOut(auth);
        window.location.href = 'admin-login.html';
      } catch (error) {
        console.error("Logout error:", error);
        alert("Logout failed. Please try again.");
      }
    });

    // Toggle sidebar
    document.getElementById("sidebarToggle").addEventListener("click", () => {
      document.querySelector(".admin-container").classList.toggle("sidebar-collapsed");
    });

    // Load initial data
    loadAdminData();
  </script>

  <style>
    /* Admin Panel Styles */
    .admin-container {
      display: flex;
      min-height: 100vh;
      background: #f5f7fa;
    }

    .admin-sidebar {
      width: 280px;
      background: #1e1e2d;
      color: white;
      transition: all 0.3s;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-header h2 {
      margin-bottom: 20px;
      font-size: 1.3rem;
    }

    .velvet {
      color: #e3069d;
    }

    .admin-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .admin-info img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 10px;
      border: 3px solid #e3069d;
    }

    .admin-info p {
      margin: 5px 0;
      font-weight: 600;
    }

    .admin-info small {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.8rem;
    }

    .sidebar-nav {
      padding: 20px 0;
    }

    .sidebar-nav ul {
      list-style: none;
    }

    .sidebar-nav li {
      margin-bottom: 5px;
    }

    .sidebar-nav a {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.3s;
    }

    .sidebar-nav a:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .sidebar-nav a i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }

    .sidebar-nav li.active a {
      background: rgba(227, 6, 157, 0.2);
      color: white;
      border-left: 3px solid #e3069d;
    }

    .sidebar-footer {
      padding: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      position: absolute;
      bottom: 0;
      width: 280px;
    }

    .sidebar-footer a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      display: flex;
      align-items: center;
    }

    .sidebar-footer a:hover {
      color: white;
    }

    .sidebar-footer a i {
      margin-right: 10px;
    }

    .admin-main {
      flex: 1;
      overflow-x: hidden;
    }

    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: white;
      box-shadow: 0 1px 15px rgba(0, 0, 0, 0.1);
    }

    .header-left {
      display: flex;
      align-items: center;
    }

    #sidebarToggle {
      background: none;
      border: none;
      font-size: 1.2rem;
      margin-right: 15px;
      cursor: pointer;
      color: #555;
    }

    .header-right {
      display: flex;
      align-items: center;
    }

    .notifications {
      position: relative;
      margin-right: 20px;
      cursor: pointer;
    }

    .notifications .badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #e3069d;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .admin-search {
      display: flex;
    }

    .admin-search input {
      padding: 8px 15px;
      border: 1px solid #ddd;
      border-radius: 4px 0 0 4px;
      outline: none;
    }

    .admin-search button {
      background: #e3069d;
      color: white;
      border: none;
      padding: 0 15px;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
    }

    .admin-content {
      padding: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 15px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 1.3rem;
      color: white;
    }

    .stat-icon.primary {
      background: #e3069d;
    }

    .stat-icon.success {
      background: #4CAF50;
    }

    .stat-icon.warning {
      background: #FFC107;
    }

    .stat-icon.danger {
      background: #F44336;
    }

    .stat-info h3 {
      font-size: 0.9rem;
      color: #777;
      margin-bottom: 5px;
    }

    .stat-info p {
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0;
    }

    .admin-row {
      display: flex;
      flex-wrap: wrap;
      margin: 0 -10px;
    }

    .admin-col {
      flex: 1;
      min-width: 300px;
      padding: 0 10px;
      margin-bottom: 20px;
    }

    .admin-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 15px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      border-bottom: 1px solid #eee;
    }

    .card-header h3 {
      margin: 0;
      font-size: 1.1rem;
    }

    .btn-link {
      color: #e3069d;
      text-decoration: none;
      font-size: 0.9rem;
    }

    .table-responsive {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    th {
      background: #f9f9f9;
      font-weight: 600;
      color: #555;
    }

    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge.primary {
      background: rgba(227, 6, 157, 0.1);
      color: #e3069d;
    }

    .badge.warning {
      background: rgba(255, 193, 7, 0.1);
      color: #FFC107;
    }

    .btn-icon {
      background: none;
      border: none;
      color: #555;
      cursor: pointer;
      margin-right: 5px;
    }

    .btn-icon:hover {
      color: #e3069d;
    }

    /* Responsive styles */
    @media (max-width: 992px) {
      .admin-container {
        flex-direction: column;
      }

      .admin-sidebar {
        width: 100%;
        position: fixed;
        z-index: 1000;
        height: auto;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s;
      }

      .admin-sidebar.active {
        max-height: 100vh;
      }

      .admin-main {
        margin-top: 60px;
      }

      .sidebar-footer {
        position: relative;
        width: auto;
      }
    }
  </style>
</body>
</html>